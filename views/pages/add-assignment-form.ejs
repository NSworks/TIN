<%- include('../fragments/header.ejs') %>


<main>
    <script type="application/javascript" src="/js/validationAssignmentForm.js"></script>
    <h2><%= pageTitle %></h2>

    <form class="form" method="post" action="<%= formAction%>" novalidate onsubmit="return validateForm();">
        <input type="hidden" name="_id" value="<%= assignment._id %>">


        <label for="caseData">Sprawa:<abbr title="required" aria-label="required">*</abbr></label>

        <select id="case_id" name="case_id" required <%=(formMode=='showDetails' ) ? 'disabled': '' %>>
            <% if (formMode !='edit' ){ %>
                <option value="" selected="selected">--Wybierz Sprawę--</option>
            <% } %>

            <%for (let i=0; i<allCases.length; i++) {let c=allCases[i]; %>
            <option value="<%= c._id %>" label="<%= c.caseName%>"
                    <%=( assignment._id && c._id.toString() == assignment.c._id.toString()) ? 'selected' : '' %>></option>
            <% } %>
        </select>
        <span id="errorCase" class="errors-text">
            <% if(validationErrors) {
            if (validationErrors.find(e => e.path.includes('case_id'))) { %>
                <%= validationErrors.find(e => e.path.includes('case_id')).message %>
            <% }
            }
            %>
        </span>


        <label for="detectiveData">Detektyw:<abbr title="required" aria-label="required">*</abbr></label>

        <select id="detective_id" name="detective_id" required  <%=(formMode=='showDetails' ) ? 'disabled' : ''%> >
            <% if (formMode !='edit' ){ %>
                <option value="" selected="selected">--Wybierz Detektywa--</option>
            <% } %>

            <% for (let i=0; i<allDetectives.length; i++) {let detective=allDetectives[i]; %>
            <option value="<%= detective._id %>" label="<%= detective.firstName + ' ' + detective.lastName %>"
                    <%=(assignment._id && detective._id.toString() == assignment.detective._id.toString()) ? 'selected' : ''%>>
            </option>
            <% } %>
        </select>

        <span id="errorDetective" class="errors-text">
            <% if(validationErrors) {
            if (validationErrors.find(e => e.path.includes('detective_id'))) { %>
                <%= validationErrors.find(e => e.path.includes('detective_id')).message %>
            <% }
            }
            %>
        </span>

        <label for="dateFrom">Data rozpoczęcia:<abbr title="required" aria-label="required">*</abbr></label>
        <input type="date" name="dateFrom" id=dateFrom" value="<%= (formMode=='createNew') ? '': assignment.dateFrom.toISOString().split('T')[0] %>" <%= (formMode == 'showDetails') ? 'disabled' : '' %> />

        <span id="errorDateFrom" class="errors-text">
            <% if(validationErrors) {
            if (validationErrors.find(e => e.path.includes('dateFrom'))) { %>
                <%= validationErrors.find(e => e.path.includes('dateFrom')).message %>
            <% }
            }
            %>
        </span>

        <label for="dateTo">Data zakończenia:</label>
        <input type="date" name="dateTo" id=dateTo" value="<%= (formMode=='createNew') ? '': assignment.dateTo.toISOString().split('T')[0] %>" <%= (formMode == 'showDetails') ? 'disabled' : '' %> />
        <span id="errorDateTo" class="errors-text">
            <% if(validationErrors) {
            if (validationErrors.find(e => e.path.includes('dateTo'))) { %>
                <%= validationErrors.find(e => e.path.includes('dateTo')).message %>
            <% }
            }
            %>
        </span>

        <% if (formMode == 'showDetails') { %>
            <div>
                <a class="list-actions-button-edit" href="/assignments/edit/<%= assignment._id %>">Edytuj</a>
            </div>
        <% } %>

        <div class="form-buttons">
            <p id="errorsSummary" class="errors-text"></p>
            <% if (formMode != 'showDetails') { %>
            <input class="form-button-submit"  type="submit" value="<%=btnLabel%>" />
            <a class="form-button-cancel" href="/assignments">Anuluj</a>
            <% } else { %>
                <a class="form-button-cancel" href="/assignments">Powrót</a>
            <% } %>
        </div>
    </form>
</main>
<%- include('../fragments/footer.ejs') %>